<div class="container py-4">

  <div>
    <div class="flex justify-between flex-wrap gap-4">
      <button class="flex gap-1 items-center w-fit" nz-button nzType="primary" type="button" (click)="goBack()">
        <svg width="20" height="20">
          <use xlink:href="/assets/icons/layout.svg#arrow-left" />
        </svg>
        <span>Volver</span>
      </button>
      <!-- <button nz-button nzType="default" type="button" (click)="updatePassword()">Cambiar contraseña</button> -->
    </div>
    <h2 class="text-lg my-4 text-center">Gestión de usuarios</h2>
    <div class="my-5 flex justify-between flex-wrap">
      <button nz-button nzType="primary" type="button" (click)="openPasswordModal()">Cambiar contraseña</button>
    </div>
  </div>

  <div class="mt-8">
    <div class="flex justify-between flex-wrap my-2">
      <h3 class="text-base">Usuarios existentes</h3>
      <button nz-button nzType="primary" type="button" (click)="openUserModal()">Agregar nuevo</button>
    </div>

    <!-- Table -->
    <div class="responsive-table">
      <nz-table #userTable [nzData]="users" [nzPageSize]="pageSize" [nzPageIndex]="page" [nzTotal]="totalData" [nzFrontPagination]="false" [nzLoading]="loadingPage" (nzQueryParams)="onQueryParamsChange($event)" class="provider-table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>correo</th>
            <th>Identificación</th>
            <th nzWidth="100px">Acción</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of userTable.data; let i = index">
            <td>{{ data.name }}</td>
            <td>{{ data.email }}</td>
            <td>{{ data.identification }}</td>
            <td>
              <button nz-button nzType="primary" type="button" class="mr-1" (click)="openUserModal(i)" nz-tooltip nzTooltipTitle="Actualizar"><span nz-icon nzType="edit"></span></button>
              <button nz-button nzDanger nzType="primary" type="button" (click)="deleteUser(i)" nz-tooltip nzTooltipTitle="Eliminar"><span nz-icon nzType="delete"></span></button>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </div>

</div>

<ng-template #passwordModalContent let-modalRef>
  <form nz-form nzLayout="vertical" [formGroup]="passwordForm" (ngSubmit)="updatePassword()">
    <nz-form-item>
      <nz-form-label nzRequired>Contraseña Actual</nz-form-label>
      <nz-form-control nzErrorTip="Campo obligatorio">
        <input nz-input type="password" formControlName="currentPassword" />
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzRequired>Nueva Contraseña</nz-form-label>
      <nz-form-control nzErrorTip="Debe tener al menos 6 caracteres">
        <input nz-input type="password" formControlName="newPassword" />
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzRequired>Confirmar Contraseña</nz-form-label>
      <nz-form-control [nzErrorTip]="'Las contraseñas no coinciden'"
                      [nzValidateStatus]="passwordForm.hasError('passwordMismatch') ? 'error' : ''">
        <input nz-input type="password" formControlName="confirmPassword" />
      </nz-form-control>
    </nz-form-item>

    <div class="flex justify-end gap-3">
      <button nz-button nzType="default" type="button" (click)="passwordModalRef.destroy()">
        Cancelar
      </button>
      <button nz-button nzType="primary" type="submit" [disabled]="passwordForm.invalid">
        Actualizar
      </button>
    </div>
  </form>
</ng-template>

<ng-template #userModalContent let-modalRef>
  <form nz-form nzLayout="vertical" [formGroup]="userForm" (ngSubmit)="saveUser()">
    <nz-form-item>
      <nz-form-label nzRequired>Nombre</nz-form-label>
      <nz-form-control [nzErrorTip]="'El campo es requerido'">
        <input nz-input formControlName="name" placeholder="Nombre del usuario" />
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzRequired>Correo</nz-form-label>
      <nz-form-control [nzErrorTip]="'El correo es requerido'">
        <input nz-input formControlName="email" type="email" placeholder="Correo electrónico" />
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzRequired>Identificación</nz-form-label>
      <nz-form-control [nzErrorTip]="'El campo es requerido'">
        <input nz-input formControlName="identification" placeholder="Número de identificación" />
      </nz-form-control>
    </nz-form-item>

    <div class="flex justify-end gap-3">
      <button nz-button nzType="default" type="button" (click)="userModalRef.destroy()">
        Cancelar
      </button>
      <button nz-button nzType="primary" type="submit" [disabled]="userForm.invalid">
        {{ selectedUserToUpdate ? 'Actualizar' : 'Agregar' }}
      </button>
    </div>
  </form>
</ng-template>
