<div class="flex justify-center mx-4">
  <div class="max-w-screen-xl w-full pt-10 pb-20 md:pt-6 flex flex-col gap-9">
    <div class="rounded-xl bg-blue2h-100">
      <div class="w-full max-w-[821px] mx-auto flex">
        <div class="hidden md:block px-4 pt-4 flex-shrink-0">
          <img
            src="assets/img/home/welcome.webp"
            alt="Imagen decorativa"
            width="183" height="220"
          />
        </div>

        <div class="flex flex-col justify-center gap-4 p-4 md:ps-0">
          <div class="flex flex-col gap-2 text-xl">
            <span class="font-semibold leading-[22px]">
              Estimado Prestador {{ user.name }}
            </span>
            <span class="font-black leading-[22px]">
              ¡Bienvenido(a) a tu Portal Transaccional de Gestión de Información y Documentos!
            </span>
          </div>
          <div class="flex rounded-lg gap-2 py-2.5 px-4 bg-blue2h-50 text-blue2h-950">
            <div class="py-2">
              <svg width="20" height="20">
                <use xlink:href="/assets/icons/outline/general.svg#lock" />
              </svg>
            </div>
            <div class="text-base font-normal leading-[18px] py-2">
              Garantizamos la protección de tus datos.
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="flex flex-col gap-4">
      <div class="flex justify-between gap-2">
        <app-text-input
          [id]="'clientSearcher'"
          [(ngModel)]="searchQuery"
          label="Buscar"
          [searcher]="true"
          [clearable]="true"
          (onInput)="applyFilter()"
          class="w-full max-w-[364px]"
        >
        </app-text-input>

        <div class="flex gap-2 items-center md:items-start">
          <app-button
            variant="primary"
            size="xs"
            [styleType]="viewMode === 'grid' ? 'solid' : 'ghost'"
            customClass="!p-1"
            (click)="setView('grid')">
            <svg width="24" height="24">
              <use xlink:href="/assets/icons/outline/general.svg#grid" />
            </svg>
          </app-button>
          <app-button
            variant="primary"
            size="xs"
            [styleType]="viewMode === 'list' ? 'solid' : 'ghost'"
            customClass="!p-1"
            (click)="setView('list')">
            <svg width="24" height="24">
              <use xlink:href="/assets/icons/outline/text.svg#list" />
            </svg>
          </app-button>
        </div>
      </div>

      <p class="text-base font-normal text-main-blue1h leading-[18px]">
        Tienes convenios activos con las siguientes compañías. Haz clic en
        alguna para cargar o actualizar tu información.
      </p>

      <ng-template #clientCardTemplate let-item>
        <div
          (click)="changeOptionClient(item, clientTutorialVisible)"
          class="flex p-4 rounded-lg cursor-pointer bg-gray-100 text-main-blue1h hover:bg-gray-100 hover:ring-[1px] hover:ring-inset hover:ring-blue1h-600 hover:shadow-[0px_16px_44px_0px_#0D0F1C1A] transition-shadow"
          [ngClass]="{
            'flex-col gap-3': viewMode === 'grid',
            'h-[98.95px] items-center gap-4': viewMode === 'list',
          }">
          <div
            class="overflow-hidden bg-gray-0 rounded-lg"
            [ngClass]="{
              'p-3.5 h-[300px] xs:h-[149.13px] sm:h-[167.03px]': viewMode === 'grid',
              'p-2 w-[67.3px] h-[67.3px] flex justify-center items-center': viewMode === 'list',
            }">
            <img
              [src]="item.url ? item.url : defaultImageUrl"
              alt="Logo cliente"
              [ngClass]="{
                'w-full h-full object-contain': viewMode === 'grid',
                'w-full object-cover': viewMode === 'list',
              }" />
          </div>
          <div class="text-base leading-[18px] font-semibold"
            [ngClass]="{
              'text-center': viewMode === 'grid'
            }">
            {{ item.clientHoneSolutions }}
          </div>
        </div>
      </ng-template>

      @if (loadingData) {
        <div class="flex items-center gap-3 text-main-blue1h text-base">
          <svg class="w-5 h-5 text-current animate-spin fill-gray-200">
            <use xlink:href="/assets/icons/extras/animations.svg#spin" />
          </svg>
          Cargando datos...
        </div>
      } @else {
        <div class="gap-4" [ngClass]="{
          'grid  grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6': viewMode === 'grid',
          'flex flex-col': viewMode === 'list',
        }">
          @for (item of filteredClients; track item.idClientHoneSolutions; let i = $index) {
            @if (i === 0) {
              <app-popover
                [title]="'Aseguradoras asociadas'"
                [text]="'Cada una solicita información y documentos específicos.'"
                [placement]="'right'"
                [triggerType]="'manual'"
                [highlighted]="true"
                [(visible)]="clientTutorialVisible"
                [contentTemplate]="popoverContent"
                customTriggerClass="w-full"
                extraPopoverClass="max-w-[330px] md:max-w-[487px]"
                [autoScrollOnOpen]="true"
                (onClose)="nextTutorialStep()"
              >
                <ng-template #triggerTemplate>
                  <ng-container *ngTemplateOutlet="clientCardTemplate; context: { $implicit: item }"></ng-container>
                </ng-template>
              </app-popover>
            } @else {
              <ng-container *ngTemplateOutlet="clientCardTemplate; context: { $implicit: item }"></ng-container>
            }
          }
        </div>
      }
    </div>
  </div>
</div>


<!-- Tutorial popover content -->
<ng-template #popoverContent>
  <img src="assets/img/home/guide2.webp"
    alt="Imagen previsualización"
    class="hidden md:block rounded-md"
  />
  <div class="flex justify-between items-center gap-2">
    <span class="text-base leading-5 md:leading-[18px] font-normal text-main-blue1h whitespace-nowrap">2 de 3</span>
    <div class="flex gap-2 md:hidden">
      <app-button
        (click)="backTutorialStep()"
        variant="primary"
        styleType="ghost"
        size="sm"
        customClass="leading-4">
        Atrás
      </app-button>
      <app-button
        (click)="nextTutorialStep()"
        variant="primary"
        styleType="soft"
        size="sm"
        customClass="leading-4">
        Siguiente
      </app-button>
    </div>
    <div class="hidden md:flex gap-2">
      <app-button
        (click)="backTutorialStep()"
        variant="primary"
        styleType="ghost"
        size="md"
        customClass="leading-4">
        Atrás
      </app-button>
      <app-button
        (click)="nextTutorialStep()"
        variant="primary"
        styleType="soft"
        size="md"
        customClass="leading-4">
        Siguiente
      </app-button>
    </div>
  </div>
</ng-template>


<app-modal #reminderModal
  [customSize]="'max-w-[454px]'"
  [position]="'bottom-right'"
  [isBackdropVisible]="false"
  [closingDuration]="300"
  (onClose)="onCloseDataReminder()"
  [customModalClass]="[
    'md:me-12 md:mb-12 ring-[1px] ring-inset ring-gray-200 md:pt-3 md:pb-[18px]',
    !reminderModal.closing ? 'animate-toast-in' : 'animate-toast-out',
  ]">

  <div class="flex flex-col gap-1">
    <div class="flex items-center justify-between">
      <h3 class="text-base font-semibold leading-[18px] text-main-blue1h dark:text-white">
        Mantén tus datos al día
      </h3>
      <app-button (click)="reminderModal.close()" variant="primary" size="sm" styleType="ghost" class="md:hidden">
        <svg width="16" height="16">
          <use xlink:href="/assets/icons/outline/general.svg#close" />
        </svg>
      </app-button>
    </div>

    <p class="text-main-blue1h text-base font-normal leading-[18px]">
      Así aseguras tu visibilidad en los directorios médicos.
    </p>
  </div>

  <img src="assets/img/home/reminder.webp"
    alt="Imagen decorativa"
    class="rounded-lg"
  />
  <div class="md:hidden flex justify-end gap-2">
    <app-button (onClick)="reminderModal.close()" variant="gray" size="sm" styleType="soft" customClass="leading-4">
      Cerrar
    </app-button>
    <app-button [routerLink]="'/update-data'" variant="primary" size="sm" styleType="solid" customClass="leading-4">
      Actualizar
    </app-button>
  </div>

  <app-button (onClick)="reminderModal.close()" variant="primary" size="md" styleType="solid" customClass="leading-4 ms-auto" class="hidden md:block">
    Entendido
  </app-button>
</app-modal>
