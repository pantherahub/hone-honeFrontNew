<div class="container py-4 sm:py-16 flex flex-col gap-8">

  <div class="py-8 pl-6 sm:pl-60 pr-8 rounded-xl bg-blue2h-100 relative">
    <img src="assets/img/home-welcome.png" alt="Imagen decorativa"
    class="hidden sm:block absolute bottom-0 left-[27px]">

    <div class="flex flex-col gap-4 text-gray-950">
      <div class="flex flex-col gap-0.5 text-xl/6 font-extrabold">
        <span>Estimado Prestador {{ user.name }}</span>
        <span>¡Bienvenido(a) a tu Portal Transaccional de Actualización de Documentos!</span>
      </div>
      <div class="text-lg/5">
        Hemos identificado que cuentas con convenios activos con las siguientes compañías aliadas. Para actualizar tu documentación, solo haz clic en el logo de la empresa correspondiente.
      </div>
      <div class="flex rounded-xl gap-2 py-2.5 px-4 bg-blue2h-50">
        <div class="py-2">
          <svg class="w-[20px] h-[20px] text-gray-950" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M8 10V7a4 4 0 1 1 8 0v3h1a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h1Zm2-3a2 2 0 1 1 4 0v3h-4V7Zm2 6a1 1 0 0 1 1 1v3a1 1 0 1 1-2 0v-3a1 1 0 0 1 1-1Z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div class="flex flex-wrap gap-1.5 py-2 text-base/5">
          <span class="font-extrabold">Tu información está segura:</span>
          Hone Solutions opera a nivel nacional, garantizando la protección de tus datos conforme a la normativa vigente.
        </div>
      </div>
    </div>
  </div>

  <div class="flex flex-col gap-4">
    <div class="flex justify-between gap-5">

      <div class="flex items-center gap-2 pt-3 pb-2.5 px-3 w-[364px] bg-gray-0 border border-gray-300 focus-within:border-blue-500 rounded-lg">
        <div class="text-gray-500">
          <svg class="w-[18px] h-[18px]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
            <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="m21 21-3.5-3.5M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/>
          </svg>
        </div>
        <input
          type="text"
          [(ngModel)]="searchQuery"
          (input)="applyFilter()"
          class="bg-transparent outline-none w-full text-sm leading-4 font-semibold text-gray-500"
          placeholder="Buscar"
        />
        <button *ngIf="searchQuery" (click)="clearSearch()" class="text-gray-500 hover:text-gray-700">
          <svg class="w-[18px] h-[18px]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/>
          </svg>
        </button>
      </div>


      <div class="flex gap-2">
        <button type="button" (click)="setView('grid')"
          class="p-2.5 rounded-full transition duration-200"
          [ngClass]="{
            'bg-blue1h-700 text-gray-0': viewMode === 'grid',
            'text-gray-700 hover:bg-gray-100': viewMode !== 'grid'
          }">
          <svg class="w-[20px] h-[20px]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M4.857 3A1.857 1.857 0 0 0 3 4.857v4.286C3 10.169 3.831 11 4.857 11h4.286A1.857 1.857 0 0 0 11 9.143V4.857A1.857 1.857 0 0 0 9.143 3H4.857Zm10 0A1.857 1.857 0 0 0 13 4.857v4.286c0 1.026.831 1.857 1.857 1.857h4.286A1.857 1.857 0 0 0 21 9.143V4.857A1.857 1.857 0 0 0 19.143 3h-4.286Zm-10 10A1.857 1.857 0 0 0 3 14.857v4.286C3 20.169 3.831 21 4.857 21h4.286A1.857 1.857 0 0 0 11 19.143v-4.286A1.857 1.857 0 0 0 9.143 13H4.857Zm10 0A1.857 1.857 0 0 0 13 14.857v4.286c0 1.026.831 1.857 1.857 1.857h4.286A1.857 1.857 0 0 0 21 19.143v-4.286A1.857 1.857 0 0 0 19.143 13h-4.286Z" clip-rule="evenodd"/>
          </svg>
        </button>
        <button type="button" (click)="setView('list')"
          class="p-2.5 rounded-full transition duration-200 "
          [ngClass]="{
            'bg-blue1h-700 text-gray-0': viewMode === 'list',
            'text-gray-700 hover:bg-gray-100': viewMode !== 'list'
          }">
          <svg class="w-[20px] h-[20px]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
            <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M9 8h10M9 12h10M9 16h10M4.99 8H5m-.02 4h.01m0 4H5"/>
          </svg>
        </button>
      </div>
    </div>

    @if (loadingData) {
      <div class="centerContent">
        <nz-spin nzSimple [nzSize]="'large'" nzTip="Cargando datos..."></nz-spin>
      </div>
    } @else if (viewMode === 'grid') {
      <div class="grid gap-4 grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6">
        @for (item of filteredClients; track item.idClientHoneSolutions; let i = $index) {
          <div [ngClass]="{ 'tutorial-option-container': i === 0, 'active-tutorial': i === 0 && clientTutorialVisible }">
            <div (click)="changeOptionClient(item)" class="h-[410px] xs:h-[218.3px] flex flex-col gap-3 p-4 rounded-lg cursor-pointer bg-gray-50 text-black border-2 border-transparent hover:bg-gray-100 hover:border-gray-0 hover:shadow-[0px_16px_44px_0px_#0D0F1C1A] transition-shadow"
              [ngClass]="{ 'tutorial-option': i === 0 }"
              nz-popover
              [nzPopoverContent]="i === 0 ? popoverContent : undefined"
              [nzPopoverVisible]="i === 0 ? clientTutorialVisible : false"
              [nzPopoverTrigger]="null"
              nzPopoverPlacement="bottomLeft"
              nzPopoverOverlayClassName="tutorial-popover tutorial-popover__home-client">
              <div class="p-3.5 h-[346px] xs:h-[185.264px] overflow-hidden bg-gray-0">
                <img class="w-full h-full object-contain" [src]="item.url ? item.url : defaultImageUrl" alt="">
              </div>
              <div class="text-base/5 font-semibold text-center">
                {{ item.clientHoneSolutions }}
              </div>
            </div>
          </div>
        }
      </div>
    } @else if (viewMode === 'list') {
      <div class="flex flex-col gap-4">
        @for (item of filteredClients; track item.idClientHoneSolutions; let i = $index) {
          <div class="tutorial-option-container" [ngClass]="{ 'active-tutorial': i === 0 && clientTutorialVisible }">
            <div (click)="changeOptionClient(item)" class="h-[98.95px] flex items-center gap-4 p-4 rounded-lg cursor-pointer bg-gray-50 text-black border-2 border-transparent hover:bg-gray-100 hover:border-gray-0 hover:shadow-[0px_16px_44px_0px_#0D0F1C1A] transition-shadow"
              [ngClass]="{ 'tutorial-option': i === 0 }"
              nz-popover
              [nzPopoverContent]="i === 0 ? popoverContent : undefined"
              [nzPopoverVisible]="i === 0 ? clientTutorialVisible : false"
              [nzPopoverTrigger]="null"
              nzPopoverPlacement="bottomLeft"
              nzPopoverOverlayClassName="tutorial-popover tutorial-popover__home-client">
              <div class="p-2 w-[67.3px] overflow-hidden bg-gray-0">
                <img class="w-full h-full object-cover" [src]="item.url ? item.url : defaultImageUrl" alt="">
              </div>
              <div class="text-base/5 font-semibold">
                {{ item.clientHoneSolutions }}
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

</div>

<button class="fixed bottom-4 right-4 sm:bottom-10 sm:right-10 bg-gray-0 hover:bg-gray-100 py-2 px-3 rounded-full sm:rounded-[2.5rem] flex gap-2" (click)="resetTutorial()">
  <span class="hidden sm:block text-sm/4 font-bold text-gray-900">Visita guiada</span>
  <div class="text-gray-700">
    <svg class="w-[16px] h-[16px]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
      <path fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm9.008-3.018a1.502 1.502 0 0 1 2.522 1.159v.024a1.44 1.44 0 0 1-1.493 1.418 1 1 0 0 0-1.037.999V14a1 1 0 1 0 2 0v-.539a3.44 3.44 0 0 0 2.529-3.256 3.502 3.502 0 0 0-7-.255 1 1 0 0 0 2 .076c.014-.398.187-.774.48-1.044Zm.982 7.026a1 1 0 1 0 0 2H12a1 1 0 1 0 0-2h-.01Z" clip-rule="evenodd"/>
    </svg>
  </div>

</button>


<!-- Tutorial video modal -->
<ng-template #videoModalTemplate let-modal>
  <div class="video-load">
    <div class="video-container">
        <iframe src="https://www.youtube.com/embed/HNnISS31dPs" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen></iframe>
    </div>
  </div>
</ng-template>


<!-- Tutorial popover content -->
<ng-template #popoverContent>
  <div class="tutorial-popover__content flex flex-col gap-6">
    <div class="flex flex-col gap-2.5 text-base/5 text-black">
      <div class="flex justify-between items-center">
        <h5 class="font-bold">Actualiza tus datos</h5>

        <button type="button" class="p-2 rounded-[2.5rem]" (click)="nextTutorialStep()">
          <svg class="w-[16px] h-[16px]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/>
          </svg>
        </button>
      </div>
      <div class="font-regular">Cada aseguradora exige los datos actualizados para completar el proceso, para ello se debe hacer clic en el logo.</div>
    </div>
    <div class="flex justify-between items-center">
      <span class="text-base/5 font-regular text-black">2 de 2</span>
      <button type="button" class="py-2.5 px-5 rounded-[2.5rem] bg-main-blue1h text-gray-0 text-base/5 font-bold" (click)="nextTutorialStep()">Entendido</button>
    </div>
  </div>
</ng-template>

<!-- Popover overlay -->
<div *ngIf="clientTutorialVisible && filteredClients.length" class="tutorial-popover-overlay" (click)="nextTutorialStep()"></div>
