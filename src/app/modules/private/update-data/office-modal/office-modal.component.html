<form nz-form nzLayout="vertical" [formGroup]="officeForm" (ngSubmit)="onSubmit()" class="office-form">
  <div>

    <div nz-row [nzGutter]="16">
      <nz-col [nzSpan]="24">
        <nz-form-label [nzRequired]="true">Correo(s)</nz-form-label>
        <div nz-row [nzGutter]="16" formArrayName="emails">
          @for (control of emailsArray.controls; track control; let i = $index) {
            <nz-col [nzSpan]="24" [nzSm]="12">
              <nz-form-item>
                <nz-form-control nzErrorTip="Ingresa un correo válido.">
                  <input
                    nz-input
                    type="email"
                    placeholder="Correo"
                    [formControlName]="i"
                  />
                  <span
                    nz-icon
                    nzType="minus-circle-o"
                    class="dynamic-delete-button"
                    *ngIf="emailsArray.length > 1"
                    (click)="removeEmail(i)"
                  ></span>
                </nz-form-control>
              </nz-form-item>
            </nz-col>
          }
          <nz-col [nzSpan]="24" [nzSm]="12">
            <nz-form-item>
              <nz-form-control>
                <button nz-button nzType="dashed" type="button" (click)="addEmail()" [disabled]="emailsArray.length >= 5">
                  <span nz-icon nzType="plus"></span> Agregar correo
                </button>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </div>
      </nz-col>

      <nz-col [nzSpan]="24" [nzSm]="12">
        <nz-form-item>
          <nz-form-label [nzRequired]="true" nzFor="address">Dirección de atención de usuarios</nz-form-label>
          <nz-form-control [nzErrorTip]="addressErrorTip">
            <ng-template #addressErrorTip>
              <p *ngIf="officeForm.controls['address'].hasError('required')">El campo es requerido.</p>
            </ng-template>
            <input nz-input id="address" formControlName="address" placeholder="Dirección" />
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="24" [nzSm]="12">
        <nz-form-item>
          <nz-form-label [nzRequired]="true" nzFor="enableCode">Código habilitación</nz-form-label>
          <nz-form-control [nzErrorTip]="enableCodeErrorTip">
            <ng-template #enableCodeErrorTip>
              <p *ngIf="officeForm.controls['enableCode'].hasError('required')">El campo es requerido.</p>
            </ng-template>
            <input nz-input id="enableCode" formControlName="enableCode" placeholder="Código" />
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="24" [nzSm]="12">
        <nz-form-item>
          <nz-form-label [nzRequired]="true" nzFor="officeName">Nombre</nz-form-label>
          <nz-form-control [nzErrorTip]="nameErrorTip">
            <ng-template #nameErrorTip>
              <p *ngIf="officeForm.controls['name'].hasError('required')">El campo es requerido.</p>
            </ng-template>
            <input nz-input id="officeName" formControlName="name" placeholder="Nombre" />
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="24" [nzSm]="12">
        <nz-form-item>
          <nz-form-label [nzRequired]="true" nzFor="idCity">Ciudad</nz-form-label>
          <nz-form-control nzErrorTip="El campo es requerido.">
            <nz-select
              id="idCity"
              formControlName="idCity"
              nzShowSearch
              [nzShowArrow]="true"
              nzPlaceHolder="Seleccionar"
            >
              <nz-option *ngFor="let city of cities" [nzValue]="city.idCity" [nzLabel]="city.city"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="24" [nzSm]="12">
        <nz-form-item nz-row>
          <nz-form-label nzFor="schedulingLink">Link de agendamiento</nz-form-label>
          <nz-form-control>
            <input nz-input id="schedulingLink" formControlName="schedulingLink" placeholder="Link" />
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="24" [nzSm]="12">
        <nz-form-item nz-row>
          <nz-form-label [nzRequired]="true" nzFor="attentionDays">Días de atención</nz-form-label>
          <nz-form-control [nzErrorTip]="attentionDaysErrorTip">
            <ng-template #attentionDaysErrorTip>
              <p *ngIf="officeForm.controls['attentionDays'].hasError('required')">El campo es requerido.</p>
            </ng-template>
            <input nz-input id="attentionDays" formControlName="attentionDays" placeholder="Días" />
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="24" [nzSm]="12">
        <nz-form-item nz-row>
          <nz-form-label [nzRequired]="true" nzFor="officeHours">Horario de atención</nz-form-label>
          <nz-form-control [nzErrorTip]="officeHoursErrorTip">
            <ng-template #officeHoursErrorTip>
              <p *ngIf="officeForm.controls['officeHours'].hasError('required')">El campo es requerido.</p>
            </ng-template>
            <input nz-input id="officeHours" formControlName="officeHours" placeholder="Horario" />
          </nz-form-control>
        </nz-form-item>
      </nz-col>

    </div>

    <!-- Contacts -->
    <div>
      <div class="table-head">
        <h3 class="table-head__title">Contactos existentes</h3>
        <button nz-button nzType="primary" type="button" (click)="openContactModal()">Agregar nuevo</button>
      </div>

      <!-- Table -->
      <nz-table #contactTable nzSize="small" [nzData]="existingContacts" [nzScroll]="{ x: '1150px', y: '240px' }" class="table">
        <thead>
          <tr>
            <th>Cargo</th>
            <th>Nombre</th>
            <th>Telefono</th>
            <th>Correo</th>
            <th nzRight>Acción</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of contactTable.data; let i = index">
            <td>{{ data.occupation.Occupation }}</td>
            <td>{{ data.name }}</td>
            <td>{{ data.phone }}</td>
            <td>{{ data.email }}</td>
            <td nzRight class="table__action">
              <button nz-button nzType="primary" type="button" (click)="openContactModal(i)" nz-tooltip nzTooltipTitle="Actualizar"><span nz-icon nzType="edit"></span></button>
              <button nz-button nzDanger nzType="primary" type="button" (click)="deleteContact(i)" nz-tooltip nzTooltipTitle="Eliminar"><span nz-icon nzType="delete"></span></button>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>

  </div>
  <div class="footer">
    <button nz-button nzType="primary" type="submit">
      {{ office ? 'Actualizar sede' : 'Agregar sede' }}
    </button>
  </div>
</form>
