@if (!isEditingOffice) {
  <div class="flex flex-col gap-4">
    <div class="flex flex-col gap-2 text-main-blue1h">
      <h2 class="text-lg font-semibold leading-5">
        Sedes de prestación de servicio
      </h2>
      <p class="text-sm leading-4">
        Los datos proporcionados en este formulario serán utilizados para actualizar los directorios de las compañías. Es fundamental que la información sea exacta y vigente.
      </p>
    </div>

    <div class="flex flex-col gap-4 p-4 rounded-xl bg-gray-100">
      <div class="flex items-center justify-between gap-4 text-main-blue1h">
        <h4 class="text-base font-semibold leading-[18px]">Sedes registradas</h4>
        <app-button
          (onClick)="openOfficeForm()"
          variant="primary"
          styleType="soft"
          size="xs">
          <svg width="16" height="16">
            <use xlink:href="/assets/icons/outline/general.svg#plus" />
          </svg>
          Agregar
        </app-button>
      </div>

      <div class="relative overflow-x-auto rounded-xl">
        <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
          <thead class="text-sm font-semibold leading-4 text-blue1h-950 bg-gray-50 dark:bg-gray-700 dark:text-gray-400 whitespace-nowrap">
            <tr>
              <th scope="col" class="px-4 py-3 font-semibold">
                Nombre
              </th>
              <th scope="col" class="px-4 py-3 font-semibold">
                Ciudad
              </th>
              <th scope="col" class="px-4 py-3 font-semibold">
                Dirección
              </th>
              <th scope="col" class="px-4 py-3 font-semibold sticky right-0 bg-gray-50 before:content-[''] before:absolute before:top-0 before:bottom-0 before:left-0 before:w-px before:bg-gray-200 sm:before:hidden">
                <span class="hidden sm:block">
                  Acciones
                </span>
              </th>
            </tr>
          </thead>
          <tbody>
            @if (!existingOffices || !existingOffices.length) {
              <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200">
                <td colspan="4" class="px-4 h-[54px] text-left">
                  <div class="text-md text-main-blue1h leading-4 flex items-center gap-2">
                    Aún no has agregado sedes
                  </div>
                </td>
              </tr>
            } @else {
              @for (data of existingOffices; let i = $index; track i) {
                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200">
                  <td class="px-4 py-[10.5px] truncate max-w-[180px] overflow-hidden text-ellipsis">
                    {{ data.name }}
                  </td>
                  <td class="px-4 py-[10.5px]">
                    {{ data.cityName || data.TemporalAddress?.City?.city || '' }}
                  </td>
                  <td class="px-4 py-[10.5px] truncate max-w-[150px] overflow-hidden text-ellipsis whitespace-nowrap">
                    {{ data.address?.formattedAddress || '' }}
                  </td>
                  <td class="px-4 py-[10.5px] sticky right-0 bg-white before:content-[''] before:absolute before:top-0 before:bottom-0 before:left-0 before:w-px before:bg-gray-200 sm:before:hidden">
                    <div class="flex gap-2">
                      <app-button
                        [appDropdownTrigger]="'dropdown-office-opts-' + i"
                        dropdownPlacement="bottom-end"
                        variant="gray"
                        styleType="soft"
                        size="xs">
                        <svg width="16" height="16">
                          <use xlink:href="/assets/icons/outline/general.svg#dots-horizontal" />
                        </svg>
                      </app-button>
                      <app-button
                        (onClick)="openOfficeForm(i)"
                        variant="gray"
                        styleType="soft"
                        size="xs"
                        class="hidden sm:block">
                        <svg width="16" height="16">
                          <use xlink:href="/assets/icons/outline/general.svg#edit" />
                        </svg>
                      </app-button>
                    </div>
                    <div [id]="'dropdown-office-opts-' + i" class="z-30 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-[136px] dark:bg-gray-700 dark:divide-gray-600">
                      <ul class="py-1 text-sm text-gray-700 dark:text-gray-200">
                        <li>
                          <a (click)="viewOffice(i)" data-dropdown-close class="flex items-center gap-3 px-4 py-2 text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">
                            <svg width="18" height="18" class="text-gray-500">
                              <use xlink:href="/assets/icons/outline/general.svg#close-sidebar" />
                            </svg>
                            Abrir
                          </a>
                        </li>
                        <li>
                          <a (click)="openOfficeForm(i)" data-dropdown-close class="flex items-center gap-3 px-4 py-2 text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">
                            <svg width="18" height="18" class="text-gray-500">
                              <use xlink:href="/assets/icons/outline/general.svg#edit" />
                            </svg>
                            Editar
                          </a>
                        </li>
                      </ul>
                      <div class="py-1">
                        <a (click)="deleteOffice(i)" data-dropdown-close class="flex items-center gap-3 px-4 py-2 text-sm text-red-500 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">
                          <svg width="18" height="18">
                            <use xlink:href="/assets/icons/outline/general.svg#trash-bin" />
                          </svg>
                          Eliminar
                        </a>
                      </div>
                    </div>
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>
    </div>

    <div class="flex justify-between">
      <app-button
        (onClick)="goPrev()"
        variant="primary"
        styleType="ghost"
        size="md">
        <svg width="20" height="20">
          <use xlink:href="/assets/icons/outline/arrows.svg#chevron-left" />
        </svg>
        Atrás
      </app-button>
      <app-button
        (onClick)="goNext()"
        variant="primary"
        styleType="solid"
        size="md">
        Siguiente
        <svg width="20" height="20">
          <use xlink:href="/assets/icons/outline/arrows.svg#chevron-right" />
        </svg>
      </app-button>
    </div>
  </div>
} @else {
  <app-office-form
    [isFirstForm]="isFirstForm"
    [office]="selectedOfficeIndex != null
      ? existingOffices[selectedOfficeIndex]
      : null"
    [companyList]="companyList"
    [providerCompanies]="providerCompanies"
    (onClose)="closeOfficeForm($event)">
  </app-office-form>
}

<app-office-detail
  #officeDetailDrawer
  [companyList]="companyList">
</app-office-detail>
